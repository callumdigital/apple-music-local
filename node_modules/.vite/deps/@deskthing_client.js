import "./chunk-BUSYA2B4.js";

// node_modules/@deskthing/types/dist/clients/clientData.js
var ClientConnectionMethod;
(function(ClientConnectionMethod2) {
  ClientConnectionMethod2[ClientConnectionMethod2["Unknown"] = 0] = "Unknown";
  ClientConnectionMethod2[ClientConnectionMethod2["LAN"] = 1] = "LAN";
  ClientConnectionMethod2[ClientConnectionMethod2["Localhost"] = 2] = "Localhost";
  ClientConnectionMethod2[ClientConnectionMethod2["ADB"] = 3] = "ADB";
  ClientConnectionMethod2[ClientConnectionMethod2["NDIS"] = 4] = "NDIS";
  ClientConnectionMethod2[ClientConnectionMethod2["Bluetooth"] = 5] = "Bluetooth";
  ClientConnectionMethod2[ClientConnectionMethod2["Internet"] = 6] = "Internet";
})(ClientConnectionMethod || (ClientConnectionMethod = {}));
var PlatformIDs;
(function(PlatformIDs2) {
  PlatformIDs2["ADB"] = "adb";
  PlatformIDs2["WEBSOCKET"] = "websocket";
  PlatformIDs2["BLUETOOTH"] = "bluetooth";
  PlatformIDs2["MAIN"] = "main";
})(PlatformIDs || (PlatformIDs = {}));
var ClientPlatformIDs;
(function(ClientPlatformIDs2) {
  ClientPlatformIDs2[ClientPlatformIDs2["Unknown"] = 0] = "Unknown";
  ClientPlatformIDs2[ClientPlatformIDs2["Desktop"] = 1] = "Desktop";
  ClientPlatformIDs2[ClientPlatformIDs2["Tablet"] = 2] = "Tablet";
  ClientPlatformIDs2[ClientPlatformIDs2["Iphone"] = 3] = "Iphone";
  ClientPlatformIDs2[ClientPlatformIDs2["CarThing"] = 4] = "CarThing";
})(ClientPlatformIDs || (ClientPlatformIDs = {}));
var ConnectionState;
(function(ConnectionState2) {
  ConnectionState2[ConnectionState2["Connected"] = 0] = "Connected";
  ConnectionState2[ConnectionState2["Established"] = 1] = "Established";
  ConnectionState2[ConnectionState2["Connecting"] = 2] = "Connecting";
  ConnectionState2[ConnectionState2["Disconnecting"] = 3] = "Disconnecting";
  ConnectionState2[ConnectionState2["Disconnected"] = 4] = "Disconnected";
  ConnectionState2[ConnectionState2["Failed"] = 5] = "Failed";
})(ConnectionState || (ConnectionState = {}));
var ProviderCapabilities;
(function(ProviderCapabilities2) {
  ProviderCapabilities2[ProviderCapabilities2["CONFIGURE"] = 0] = "CONFIGURE";
  ProviderCapabilities2[ProviderCapabilities2["PING"] = 1] = "PING";
  ProviderCapabilities2[ProviderCapabilities2["COMMUNICATE"] = 2] = "COMMUNICATE";
})(ProviderCapabilities || (ProviderCapabilities = {}));
var ViewMode;
(function(ViewMode2) {
  ViewMode2["HIDDEN"] = "hidden";
  ViewMode2["PEEK"] = "peek";
  ViewMode2["FULL"] = "full";
})(ViewMode || (ViewMode = {}));
var VolMode;
(function(VolMode2) {
  VolMode2["WHEEL"] = "wheel";
  VolMode2["SLIDER"] = "slider";
  VolMode2["BAR"] = "bar";
})(VolMode || (VolMode = {}));

// node_modules/@deskthing/types/dist/clients/clientTransit.js
var CLIENT_REQUESTS;
(function(CLIENT_REQUESTS2) {
  CLIENT_REQUESTS2["GET"] = "get";
  CLIENT_REQUESTS2["ACTION"] = "action";
  CLIENT_REQUESTS2["BUTTON"] = "button";
  CLIENT_REQUESTS2["KEY"] = "key";
  CLIENT_REQUESTS2["LOG"] = "log";
})(CLIENT_REQUESTS || (CLIENT_REQUESTS = {}));
var DEVICE_CLIENT;
(function(DEVICE_CLIENT2) {
  DEVICE_CLIENT2["MANIFEST"] = "manifest";
  DEVICE_CLIENT2["MUSIC"] = "music";
  DEVICE_CLIENT2["SETTINGS"] = "settings";
  DEVICE_CLIENT2["APPS"] = "apps";
  DEVICE_CLIENT2["ACTION"] = "action";
  DEVICE_CLIENT2["TIME"] = "time";
  DEVICE_CLIENT2["ICON"] = "icon";
})(DEVICE_CLIENT || (DEVICE_CLIENT = {}));
var DEVICE_DESKTHING;
(function(DEVICE_DESKTHING2) {
  DEVICE_DESKTHING2["ACTION"] = "action";
  DEVICE_DESKTHING2["SET"] = "set";
  DEVICE_DESKTHING2["GET"] = "get";
  DEVICE_DESKTHING2["PING"] = "ping";
  DEVICE_DESKTHING2["PONG"] = "pong";
  DEVICE_DESKTHING2["LOG"] = "log";
  DEVICE_DESKTHING2["VIEW"] = "view";
  DEVICE_DESKTHING2["APP_PAYLOAD"] = "app_payload";
  DEVICE_DESKTHING2["MANIFEST"] = "manifest";
  DEVICE_DESKTHING2["SETTINGS"] = "settings";
  DEVICE_DESKTHING2["CONFIG"] = "config";
})(DEVICE_DESKTHING || (DEVICE_DESKTHING = {}));

// node_modules/@deskthing/types/dist/apps/appData.js
var PlatformTypes;
(function(PlatformTypes2) {
  PlatformTypes2["WINDOWS"] = "windows";
  PlatformTypes2["LINUX"] = "linux";
  PlatformTypes2["MAC"] = "mac";
  PlatformTypes2["MAC64"] = "mac64";
  PlatformTypes2["MACARM"] = "macarm";
  PlatformTypes2["ANDROID"] = "android";
  PlatformTypes2["IOS"] = "ios";
  PlatformTypes2["ARM64"] = "arm64";
  PlatformTypes2["X64"] = "x64";
})(PlatformTypes || (PlatformTypes = {}));
var TagTypes;
(function(TagTypes2) {
  TagTypes2["AUDIO_SOURCE"] = "audiosource";
  TagTypes2["SCREEN_SAVER"] = "screensaver";
  TagTypes2["UTILITY_ONLY"] = "utilityOnly";
  TagTypes2["WEB_APP_ONLY"] = "webappOnly";
})(TagTypes || (TagTypes = {}));

// node_modules/@deskthing/types/dist/apps/appSettings.js
var SETTING_TYPES;
(function(SETTING_TYPES2) {
  SETTING_TYPES2["BOOLEAN"] = "boolean";
  SETTING_TYPES2["NUMBER"] = "number";
  SETTING_TYPES2["STRING"] = "string";
  SETTING_TYPES2["RANGE"] = "range";
  SETTING_TYPES2["SELECT"] = "select";
  SETTING_TYPES2["MULTISELECT"] = "multiselect";
  SETTING_TYPES2["LIST"] = "list";
  SETTING_TYPES2["RANKED"] = "ranked";
  SETTING_TYPES2["COLOR"] = "color";
  SETTING_TYPES2["FILE"] = "file";
})(SETTING_TYPES || (SETTING_TYPES = {}));

// node_modules/@deskthing/types/dist/apps/appTasks.js
var STEP_TYPES;
(function(STEP_TYPES2) {
  STEP_TYPES2["ACTION"] = "action";
  STEP_TYPES2["SHORTCUT"] = "shortcut";
  STEP_TYPES2["SETTING"] = "setting";
  STEP_TYPES2["TASK"] = "task";
  STEP_TYPES2["EXTERNAL"] = "external";
  STEP_TYPES2["STEP"] = "step";
})(STEP_TYPES || (STEP_TYPES = {}));

// node_modules/@deskthing/types/dist/apps/appTransit.js
var APP_REQUESTS;
(function(APP_REQUESTS2) {
  APP_REQUESTS2["DEFAULT"] = "default";
  APP_REQUESTS2["GET"] = "get";
  APP_REQUESTS2["SET"] = "set";
  APP_REQUESTS2["DELETE"] = "delete";
  APP_REQUESTS2["OPEN"] = "open";
  APP_REQUESTS2["SEND"] = "send";
  APP_REQUESTS2["TOAPP"] = "toApp";
  APP_REQUESTS2["LOG"] = "log";
  APP_REQUESTS2["KEY"] = "key";
  APP_REQUESTS2["ACTION"] = "action";
  APP_REQUESTS2["TASK"] = "task";
  APP_REQUESTS2["STEP"] = "step";
  APP_REQUESTS2["SONG"] = "song";
  APP_REQUESTS2["MESSAGE"] = "message";
})(APP_REQUESTS || (APP_REQUESTS = {}));

// node_modules/@deskthing/types/dist/meta/logging.js
var LOGGING_LEVELS;
(function(LOGGING_LEVELS2) {
  LOGGING_LEVELS2["MESSAGE"] = "message";
  LOGGING_LEVELS2["LOG"] = "log";
  LOGGING_LEVELS2["WARN"] = "warning";
  LOGGING_LEVELS2["ERROR"] = "error";
  LOGGING_LEVELS2["DEBUG"] = "debugging";
  LOGGING_LEVELS2["FATAL"] = "fatal";
})(LOGGING_LEVELS || (LOGGING_LEVELS = {}));

// node_modules/@deskthing/types/dist/meta/music.js
var SongAbilities;
(function(SongAbilities2) {
  SongAbilities2["LIKE"] = "like";
  SongAbilities2["SHUFFLE"] = "shuffle";
  SongAbilities2["REPEAT"] = "repeat";
  SongAbilities2["PLAY"] = "play";
  SongAbilities2["PAUSE"] = "pause";
  SongAbilities2["STOP"] = "stop";
  SongAbilities2["NEXT"] = "next";
  SongAbilities2["PREVIOUS"] = "previous";
  SongAbilities2["REWIND"] = "rewind";
  SongAbilities2["FAST_FORWARD"] = "fast_forward";
  SongAbilities2["CHANGE_VOLUME"] = "change_volume";
  SongAbilities2["SET_OUTPUT"] = "set_output";
})(SongAbilities || (SongAbilities = {}));
var AUDIO_REQUESTS;
(function(AUDIO_REQUESTS2) {
  AUDIO_REQUESTS2["NEXT"] = "next";
  AUDIO_REQUESTS2["PREVIOUS"] = "previous";
  AUDIO_REQUESTS2["REWIND"] = "rewind";
  AUDIO_REQUESTS2["FAST_FORWARD"] = "fast_forward";
  AUDIO_REQUESTS2["PLAY"] = "play";
  AUDIO_REQUESTS2["PAUSE"] = "pause";
  AUDIO_REQUESTS2["STOP"] = "stop";
  AUDIO_REQUESTS2["SEEK"] = "seek";
  AUDIO_REQUESTS2["LIKE"] = "like";
  AUDIO_REQUESTS2["SONG"] = "song";
  AUDIO_REQUESTS2["VOLUME"] = "volume";
  AUDIO_REQUESTS2["REPEAT"] = "repeat";
  AUDIO_REQUESTS2["SHUFFLE"] = "shuffle";
  AUDIO_REQUESTS2["REFRESH"] = "refresh";
})(AUDIO_REQUESTS || (AUDIO_REQUESTS = {}));
var SongEvent;
(function(SongEvent2) {
  SongEvent2["GET"] = "get";
  SongEvent2["SET"] = "set";
})(SongEvent || (SongEvent = {}));

// node_modules/@deskthing/types/dist/meta/transit.js
var TransitSources;
(function(TransitSources2) {
  TransitSources2["CLIENT"] = "client";
  TransitSources2["APP"] = "app";
  TransitSources2["DEVICE"] = "device";
  TransitSources2["DESKTHING"] = "deskthing";
  TransitSources2["CONCLIENT"] = "conclient";
  TransitSources2["CONSERVER"] = "conserver";
})(TransitSources || (TransitSources = {}));

// node_modules/@deskthing/types/dist/deskthing/deskthingTransit.js
var DESKTHING_DEVICE;
(function(DESKTHING_DEVICE2) {
  DESKTHING_DEVICE2["GLOBAL_SETTINGS"] = "global_settings";
  DESKTHING_DEVICE2["MAPPINGS"] = "button_mappings";
  DESKTHING_DEVICE2["CONFIG"] = "configuration";
  DESKTHING_DEVICE2["GET"] = "get";
  DESKTHING_DEVICE2["ERROR"] = "error";
  DESKTHING_DEVICE2["PONG"] = "pong";
  DESKTHING_DEVICE2["PING"] = "ping";
  DESKTHING_DEVICE2["SETTINGS"] = "settings";
  DESKTHING_DEVICE2["APPS"] = "apps";
  DESKTHING_DEVICE2["TIME"] = "time";
  DESKTHING_DEVICE2["HEARTBEAT"] = "heartbeat";
  DESKTHING_DEVICE2["META_DATA"] = "meta_data";
  DESKTHING_DEVICE2["MUSIC"] = "music";
  DESKTHING_DEVICE2["ICON"] = "icon";
})(DESKTHING_DEVICE || (DESKTHING_DEVICE = {}));
var DESKTHING_EVENTS;
(function(DESKTHING_EVENTS2) {
  DESKTHING_EVENTS2["MESSAGE"] = "message";
  DESKTHING_EVENTS2["DATA"] = "data";
  DESKTHING_EVENTS2["APPDATA"] = "appdata";
  DESKTHING_EVENTS2["CALLBACK_DATA"] = "callback-data";
  DESKTHING_EVENTS2["START"] = "start";
  DESKTHING_EVENTS2["STOP"] = "stop";
  DESKTHING_EVENTS2["PURGE"] = "purge";
  DESKTHING_EVENTS2["INPUT"] = "input";
  DESKTHING_EVENTS2["ACTION"] = "action";
  DESKTHING_EVENTS2["CONFIG"] = "config";
  DESKTHING_EVENTS2["SETTINGS"] = "settings";
  DESKTHING_EVENTS2["TASKS"] = "tasks";
  DESKTHING_EVENTS2["CLIENT_STATUS"] = "client_status";
})(DESKTHING_EVENTS || (DESKTHING_EVENTS = {}));

// node_modules/@deskthing/types/dist/deskthing/mappings.js
var EventFlavor;
(function(EventFlavor2) {
  EventFlavor2[EventFlavor2["KeyUp"] = 0] = "KeyUp";
  EventFlavor2[EventFlavor2["KeyDown"] = 1] = "KeyDown";
  EventFlavor2[EventFlavor2["ScrollUp"] = 2] = "ScrollUp";
  EventFlavor2[EventFlavor2["ScrollDown"] = 3] = "ScrollDown";
  EventFlavor2[EventFlavor2["ScrollLeft"] = 4] = "ScrollLeft";
  EventFlavor2[EventFlavor2["ScrollRight"] = 5] = "ScrollRight";
  EventFlavor2[EventFlavor2["SwipeUp"] = 6] = "SwipeUp";
  EventFlavor2[EventFlavor2["SwipeDown"] = 7] = "SwipeDown";
  EventFlavor2[EventFlavor2["SwipeLeft"] = 8] = "SwipeLeft";
  EventFlavor2[EventFlavor2["SwipeRight"] = 9] = "SwipeRight";
  EventFlavor2[EventFlavor2["PressShort"] = 10] = "PressShort";
  EventFlavor2[EventFlavor2["PressLong"] = 11] = "PressLong";
})(EventFlavor || (EventFlavor = {}));
var EventMode;
(function(EventMode2) {
  EventMode2[EventMode2["KeyUp"] = 0] = "KeyUp";
  EventMode2[EventMode2["KeyDown"] = 1] = "KeyDown";
  EventMode2[EventMode2["ScrollUp"] = 2] = "ScrollUp";
  EventMode2[EventMode2["ScrollDown"] = 3] = "ScrollDown";
  EventMode2[EventMode2["ScrollLeft"] = 4] = "ScrollLeft";
  EventMode2[EventMode2["ScrollRight"] = 5] = "ScrollRight";
  EventMode2[EventMode2["SwipeUp"] = 6] = "SwipeUp";
  EventMode2[EventMode2["SwipeDown"] = 7] = "SwipeDown";
  EventMode2[EventMode2["SwipeLeft"] = 8] = "SwipeLeft";
  EventMode2[EventMode2["SwipeRight"] = 9] = "SwipeRight";
  EventMode2[EventMode2["PressShort"] = 10] = "PressShort";
  EventMode2[EventMode2["PressLong"] = 11] = "PressLong";
})(EventMode || (EventMode = {}));

// node_modules/@deskthing/client/dist/deskthing.js
var __awaiter = function(thisArg, _arguments, P, generator) {
  function adopt(value) {
    return value instanceof P ? value : new P(function(resolve) {
      resolve(value);
    });
  }
  return new (P || (P = Promise))(function(resolve, reject) {
    function fulfilled(value) {
      try {
        step(generator.next(value));
      } catch (e) {
        reject(e);
      }
    }
    function rejected(value) {
      try {
        step(generator["throw"](value));
      } catch (e) {
        reject(e);
      }
    }
    function step(result) {
      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);
    }
    step((generator = generator.apply(thisArg, _arguments || [])).next());
  });
};
var DeskThingClass = class _DeskThingClass {
  /**
   * Initializes the DeskThing instance and sets up event listeners.
   * Sends a message to the parent indicating that the client has started.
   * Also sets up a click event listener for buttons.
   * @version 0.10.4
   */
  constructor() {
    this.listeners = {};
    this.onceListenerKeys = /* @__PURE__ */ new Set();
    this.keyOverrides = /* @__PURE__ */ new Set();
    this.fetch = (requestData, listenFor, callbackFn) => __awaiter(this, void 0, void 0, function* () {
      if (!requestData.type) {
        console.warn("Request data must have a type property");
        return void 0;
      }
      if (!listenFor)
        return;
      if (!listenFor.type) {
        console.warn("Listen for data must have a type property");
        return void 0;
      }
      const listenKey = `${listenFor.type}-${listenFor.request || "undefined"}`;
      const timeout = new Promise((_, reject) => {
        setTimeout(() => {
          return reject(new Error(`Timed out waiting for response: type=${listenFor.type}, request=${listenFor.request || "undefined"}`));
        }, 5e3);
      });
      let removeListener;
      const dataPromise = new Promise((resolve) => {
        removeListener = this.once(listenFor.type, (data2) => {
          this.onceListenerKeys.delete(listenKey);
          resolve(data2);
        }, listenFor.request);
        if (!this.onceListenerKeys.has(listenKey)) {
          this.send(requestData);
          this.onceListenerKeys.add(listenKey);
        }
      });
      const data = Promise.race([dataPromise, timeout]).catch((error) => {
        this.error(error);
        removeListener && removeListener();
        this.onceListenerKeys.delete(listenKey);
        return void 0;
      });
      if (callbackFn) {
        data.then((data2) => callbackFn(data2));
      }
      return data;
    });
    this.fetchData = (type, requestData, request) => __awaiter(this, void 0, void 0, function* () {
      return this.fetch(
        requestData,
        { type, request }
        // Not good typing - but this is depreciated
      );
    });
    this.getMusic = () => __awaiter(this, void 0, void 0, function* () {
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "music"
      }, {
        type: DEVICE_CLIENT.MUSIC
      });
      if (!socketResponse)
        return void 0;
      const musicData = socketResponse.payload;
      if (musicData && musicData.thumbnail) {
        musicData.thumbnail = this.formatImageUrl(musicData.thumbnail);
      }
      return musicData;
    });
    this.getSettings = () => __awaiter(this, void 0, void 0, function* () {
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "settings"
      }, {
        type: DEVICE_CLIENT.SETTINGS
      });
      if (!socketResponse)
        return void 0;
      return socketResponse.payload;
    });
    this.getApps = () => __awaiter(this, void 0, void 0, function* () {
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "apps"
      }, {
        type: DEVICE_CLIENT.APPS
      });
      if (!socketResponse)
        return void 0;
      return socketResponse.payload;
    });
    this.getKeyIcon = (KeyReference) => __awaiter(this, void 0, void 0, function* () {
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "key",
        payload: KeyReference
      }, { type: KeyReference.id });
      if (!socketResponse)
        return void 0;
      return socketResponse.payload;
    });
    this.getActionIcon = (action) => __awaiter(this, void 0, void 0, function* () {
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "action",
        payload: action
      }, { type: action.id });
      if (!socketResponse)
        return void 0;
      return socketResponse.payload;
    });
    this.triggerAction = (action) => __awaiter(this, void 0, void 0, function* () {
      var _a, _b;
      this.send({
        app: "client",
        type: CLIENT_REQUESTS.ACTION,
        payload: Object.assign(Object.assign({}, action), { enabled: (_a = action.enabled) !== null && _a !== void 0 ? _a : true, source: action.source || ((_b = this.manifest) === null || _b === void 0 ? void 0 : _b.id) || "server" })
      });
    });
    this.triggerKey = (KeyReference) => __awaiter(this, void 0, void 0, function* () {
      var _a;
      if (!KeyReference.source) {
        KeyReference.source = ((_a = this.manifest) === null || _a === void 0 ? void 0 : _a.name) || "server";
      }
      this.send({
        app: "client",
        type: CLIENT_REQUESTS.KEY,
        payload: KeyReference
      });
    });
    this.getManifest = () => __awaiter(this, void 0, void 0, function* () {
      if (this.manifest) {
        return this.manifest;
      }
      const socketResponse = yield this.fetch({
        app: "client",
        type: CLIENT_REQUESTS.GET,
        request: "manifest"
      }, {
        type: DEVICE_CLIENT.MANIFEST
      });
      if (!socketResponse)
        return void 0;
      this.manifest = socketResponse.payload;
      return socketResponse.payload;
    });
    this.formatImageUrl = (image) => {
      var _a, _b, _c, _d, _e;
      if (!((_a = this.manifest) === null || _a === void 0 ? void 0 : _a.context)) {
        return image;
      }
      if (image.startsWith("data:image")) {
        return image;
      }
      if (this.manifest.context.id == ClientPlatformIDs.CarThing || this.manifest.context.ip == "localhost") {
        return image.replace("localhost:8891", `${((_c = (_b = this.manifest) === null || _b === void 0 ? void 0 : _b.context) === null || _c === void 0 ? void 0 : _c.ip) || "localhost"}:${((_e = (_d = this.manifest) === null || _d === void 0 ? void 0 : _d.context) === null || _e === void 0 ? void 0 : _e.port) || 8891}`);
      }
      return image;
    };
    this.useProxy = (url) => {
      var _a, _b, _c, _d;
      if (url.startsWith("data:image")) {
        return url;
      }
      return `http://${((_b = (_a = this.manifest) === null || _a === void 0 ? void 0 : _a.context) === null || _b === void 0 ? void 0 : _b.ip) || "localhost"}:${((_d = (_c = this.manifest) === null || _c === void 0 ? void 0 : _c.context) === null || _d === void 0 ? void 0 : _d.port) || 8891}/proxy/v1?url=${encodeURIComponent(url)}`;
    };
    this.initialize();
    this.initializeListeners();
  }
  /**
   * Initializes the message event listener.
   * @private
   * @version 0.10.4
   */
  initialize() {
    window.addEventListener("message", this.handleMessage.bind(this));
  }
  /**
   * Sets up the listeners and bubbles them to the server
   * @private
   * @version 0.10.4
   */
  initializeListeners() {
    return __awaiter(this, void 0, void 0, function* () {
      const eventsToForward = ["wheel", "keydown", "keyup"];
      const forwardEvent = (event) => {
        if (event.defaultPrevented) {
          return;
        }
        if (event instanceof KeyboardEvent) {
          const key = event.code;
          if (this.keyOverrides.has(key.toLowerCase())) {
            return;
          }
          const mode = event.type === "keydown" ? EventMode.KeyDown : EventMode.KeyUp;
          this.triggerKey({ id: key, mode });
        } else if (event instanceof WheelEvent) {
          if (this.keyOverrides.has("wheel")) {
            return;
          }
          let mode = EventMode.ScrollUp;
          if (event.deltaY > 0)
            mode = EventMode.ScrollDown;
          else if (event.deltaY < 0)
            mode = EventMode.ScrollUp;
          else if (event.deltaX > 0)
            mode = EventMode.ScrollRight;
          else if (event.deltaX < 0)
            mode = EventMode.ScrollLeft;
          this.triggerKey({ id: "Scroll", mode });
        }
      };
      const options = {
        capture: true,
        passive: false
      };
      eventsToForward.forEach((eventType) => {
        document.addEventListener(eventType, forwardEvent, options);
      });
      const fetchManifest = () => __awaiter(this, void 0, void 0, function* () {
        this.manifest = yield this.fetchData("manifest", {
          type: CLIENT_REQUESTS.GET,
          request: "manifest",
          app: "client"
        });
      });
      const handleManifest = (socketData) => __awaiter(this, void 0, void 0, function* () {
        if (socketData.type == DEVICE_CLIENT.MANIFEST && socketData.payload) {
          this.info("Received the manifest from the server");
          this.manifest = socketData.payload;
        }
      });
      fetchManifest();
      this.on(DEVICE_CLIENT.MANIFEST, handleManifest);
    });
  }
  /**
  * Prevents default DeskThing handling for specific keys
  * @param keys - Array of key codes to override (e.g., ['KeyA', 'Enter', 'Space'])
  * @example
  * deskThing.overrideKeys(['KeyA', 'Enter', 'Scroll']);
  */
  overrideKeys(keys) {
    keys.forEach((key) => this.keyOverrides.add(key.toLowerCase()));
  }
  /**
   * Removes key overrides
   * @param keys - Array of key codes to restore default
   * @example
   * deskThing.restoreKeys(['KeyA', 'Enter', 'Scroll']);
   */
  restoreKeys(keys) {
    keys.forEach((key) => this.keyOverrides.delete(key.toLowerCase()));
  }
  /**
   * Singleton pattern: Ensures only one instance of DeskThing exists.
   * @returns {DeskThingClass} The single instance of DeskThing
   * @version 0.10.4
   *
   * @example
   * const deskThing = DeskThing.getInstance();
   */
  static getInstance() {
    if (!this.instance) {
      this.instance = new _DeskThingClass();
    }
    return this.instance;
  }
  /**
   * Registers an event listener for a specific event type.
   * @param {string} type - The type of event to listen for
   * @param {EventCallback} callback - The function to call when the event occurs
   * @returns {Function} A function to remove the event listener
   * @version 0.10.4
   *
   * @example
   * const removeListener = deskThing.on('music', (data: SocketData) => {
   *   console.log('Received music data:', data.payload);
   * });
   *
   * @example
   * // Client-side code (here)
   * const removeListener = deskThing.on('customdata', (data: SocketData) => {
   *   console.log('Received custom data:', data.payload);
   * });
   *
   * // Server-side code
   * DeskThing.send({ type: 'customdata', payload: 'Hello from the server!' });
   */
  on(type, callback) {
    if (!this.listeners[type]) {
      this.listeners[type] = [];
    }
    this.listeners[type].push(callback);
    return () => this.off(type, callback);
  }
  /**
   * Removes an event listener for a specific event type.
   * @param {string} type - The type of event to remove the listener from
   * @param {EventCallback} callback - The function to remove from the listeners
   * @version 0.10.4
   *
   * @example
   * deskThing.off('message', messageCallback);
   */
  off(type, callback) {
    if (this.listeners[type]) {
      this.listeners[type] = this.listeners[type].filter((listener) => listener !== callback);
    }
  }
  /**
   * Handles incoming messages from the parent window.
   * @param {MessageEvent} event - The message event received
   * @private
   * @version 0.10.4
   */
  handleMessage(event) {
    if (event.data.source !== "deskthing")
      return;
    const socketData = event.data;
    this.emit(socketData.type, socketData);
  }
  /**
   * Emits an event to all registered listeners for that event type.
   * @param {string} type - The type of event to emit
   * @param {SocketData} data - The data to pass to the event listeners
   * @returns {Promise<void>}
   * @private
   * @version 0.10.4
   */
  emit(type, data) {
    return __awaiter(this, void 0, void 0, function* () {
      const callbacks = this.listeners[type];
      if (callbacks) {
        const promises = callbacks.map((callback) => __awaiter(this, void 0, void 0, function* () {
          try {
            yield callback(data);
          } catch (error) {
            console.error("Error in event callback:", error);
          }
        }));
        Promise.all(promises);
      }
      const listenKey = `${type}-${data.request || "undefined"}`;
      const res = this.onceListenerKeys.delete(listenKey);
      if (res) {
        this.debug(`Removed callback key ${listenKey} because the callback was resolved`);
      }
    });
  }
  /**
   * Listens for a single occurrence of an event, then removes the listener
   * @param {string} type - The event type to listen for
   * @param {EventCallback} callback - The function to call when the event occurs
   * @returns {Function} - Function to manually remove the listener
   * @version 0.10.4
   *
   * @example
   * deskThing.once('music', (data) => {
   *   console.log('Received music data:', data.payload);
   * });
   *
   * @example
   * // Client-side code (here)
   * deskThing.once('data', (data) => {
   *   console.log('Received specific request:', data.payload); // prints Payload 3 once
   * }, 'specificRequest');
   *
   *  // Server-side code
   * DeskThing.send({ type: 'data', payload: 'Payload 1', request: 'someRequest' }); // Wont send
   * DeskThing.send({ type: 'data', payload: 'Payload 2', request: 'randomRequest' }); // Wont send
   * DeskThing.send({ type: 'data', payload: 'Payload 3', request: 'specificRequest' }); // Will send
   * DeskThing.send({ type: 'data', payload: 'Payload 4', request: 'faultyRequest' }); // Wont send
   * DeskThing.send({ type: 'data', payload: 'Payload 5', request: 'specificRequest' }); // Wont send
   */
  once(type, callback, request) {
    const removeListener = this.on(type, (data) => {
      if (request && data.request !== request)
        return;
      callback(data);
      removeListener();
    });
    return removeListener;
  }
  /**
   * Sends a message to the parent window.
   * @param {SocketData} data - The data to send to the parent. "app" defaults to the current app
   * @deprecated Use send() instead
   * @example
   * deskThing.sendMessageToParent({
   *   app: 'client',
   *   type: 'action',
   *   payload: { buttonClicked: 'submit' }
   * });
   */
  sendMessageToParent(data) {
    this.send(data);
  }
  /**
   * Sends a message to the parent window.
   * @param {SocketData} data - The data to send to the parent. "app" defaults to the current app
   *
   * @example
   * deskThing.send({
   *   app: 'client',
   *   type: 'action',
   *   payload: { buttonClicked: 'submit' }
   * });
   */
  send(data) {
    var _a;
    const payload = {
      app: data.app || void 0,
      type: data.type || void 0,
      request: data.request || null,
      payload: (_a = data.payload) !== null && _a !== void 0 ? _a : null
    };
    window.parent.postMessage({ type: "IFRAME_ACTION", payload }, "*");
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.log(LOGGING_LEVELS.INFO, 'This is an info message', 'this is extra data');
   * // logs "[CLIENT]: This is an info message this is extra data" to the console
   * // logs "[YourApp] This is an info message" to the client
   * // logs "[CLIENT.YourApp] This is an info message" to the server
   */
  log(level, message, ...extraData) {
    this.send({
      app: "client",
      type: CLIENT_REQUESTS.LOG,
      request: level,
      payload: { message, data: [...extraData] }
    });
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.error('This is an error message', 'this is extra data');
   * // logs "[CLIENT]: This is an error message this is extra data" to the console
   * // logs "[YourApp] This is an error message" to the client
   * // logs "[CLIENT.YourApp] This is an error message" to the server
   */
  error(message, ...extraData) {
    this.log(LOGGING_LEVELS.ERROR, message, ...extraData);
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.warn('This is a warning message', 'this is extra data');
   * // logs "[CLIENT]: This is a warning message this is extra data" to the console
   * // logs "[YourApp] This is a warning message" to the client
   * // logs "[CLIENT.YourApp] This is a warning message" to the server
   */
  warn(message, ...extraData) {
    this.log(LOGGING_LEVELS.WARN, message, ...extraData);
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.debug('This is a debug message', 'this is extra data');
   * // logs "[CLIENT]: This is a debug message this is extra data" to the console
   * // logs "[YourApp] This is a debug message" to the client
   * // logs "[CLIENT.YourApp] This is a debug message" to the server
   */
  debug(message, ...extraData) {
    this.log(LOGGING_LEVELS.DEBUG, message, ...extraData);
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.fatal('This is a fatal message', 'this is extra data');
   * // logs "[CLIENT]: This is a fatal message this is extra data" to the console
   * // logs "[YourApp] This is a fatal message" to the client
   * // logs "[CLIENT.YourApp] This is a fatal message" to the server
   */
  fatal(message, ...extraData) {
    this.log(LOGGING_LEVELS.FATAL, message, ...extraData);
  }
  /**
   * Logs the message in the console, the client, and the server
   * The extra data logged will not be bubbled anywhere but the console
   *
   * @example
   * DeskThing.info('This is an info message', 'this is extra data');
   * // logs "[CLIENT]: This is an info message this is extra data" to the console
   * // logs "[YourApp] This is an info message" to the client
   * // logs "[CLIENT.YourApp] This is a fatal message" to the server
   */
  info(message, ...extraData) {
    this.log(LOGGING_LEVELS.LOG, message, ...extraData);
  }
};
function createDeskThing() {
  return DeskThingClass.getInstance();
}
var DeskThing = createDeskThing();
export {
  DeskThing,
  DeskThingClass,
  createDeskThing
};
//# sourceMappingURL=@deskthing_client.js.map
